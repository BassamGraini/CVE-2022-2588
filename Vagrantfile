Vagrant.configure("2") do |config|
  config.vm.box = "ubuntu/focal64"
   config.vm.provider "virtualbox" do |vb|
     vb.memory = "2048"
     vb.cpus = "1"

   end

   config.vm.provision "shell", inline: <<-SHELL
     apt-get update
     apt-get install -y  git gcc gdb
     sudo useradd simpleUser
     sudo echo 'simpleUser:toto' | chpasswd
     cd /tmp/
     wget -c https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.0.10/linux-headers-5.0.10-050010_5.0.10-050010.201904270832_all.deb
     wget -c https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.0.10/linux-headers-5.0.10-050010-generic_5.0.10-050010.201904270832_amd64.deb
     wget -c https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.0.10/linux-image-unsigned-5.0.10-050010-generic_5.0.10-050010.201904270832_amd64.deb
     wget -c https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.0.10/linux-modules-5.0.10-050010-generic_5.0.10-050010.201904270832_amd64.deb
     sudo dpkg -i *.deb
     sudo sed -i '6s/.*/GRUB_DEFAULT="1>2"/' /etc/default/grub
     sudo update-grub
     cd /home/vagrant
     git clone https://github.com/BassamGraini/CVE-2022-2588.git
     sudo chown -R vagrant /home/vagrant/CVE-2022-2588
     gcc -g3 /home/vagrant/CVE-2022-2588/exploit.c -lpthread
     sudo reboot
   SHELL
 


end
