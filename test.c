#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <unistd.h>
#include <sys/syscall.h>
#include <linux/kcmp.h>



int read_file_1(){
    int ptr = open("./dummy.txt", 1);
    return ptr;
}

int read_file_2(){
    int ptr = open("/tmp/notAllowed.txt", O_RDONLY);
    return ptr;
}

int main() {
    int ptr_1 = read_file_1();
    int ptr_2 = read_file_1();

    //printf("Ptr 1: %i\n", ptr);

    write(ptr_1, "Bassam", 6);
    printf("Ptr 2: %i\n", ptr_1);

    if (syscall(__NR_kcmp, getpid(), getpid(), KCMP_FILE, ptr_1, ptr_2) == 0){
        printf("Overlap done!");
    }
    else{
        printf("Overlap not found .. :( ");
    }
    close(ptr_1);
    close(ptr_2);
    return 0;
}
  